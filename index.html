<html>
	<head>
		<title>Music Genre Identifier</title>
		<link rel="stylesheet" type="text/css" href="style.css" />
		<script type="text/javascript">
			requests=0;
			requestId = "";
			
			function initalRequest(){
				requestId="PNjG22Gbo6U";//temp, dev hack 
				youtubeurl = document.getElementById("urlfield").value;
				var xhttp = new XMLHttpRequest();
				xhttp.open("GET", "http://localhost/cgi-bin/genreclassifier.py?youtubeurl="+encodeURIComponent(youtubeurl), true);
				if (xhttp.readyState == XMLHttpRequest.DONE && xhttp.status == 200) {
					document.getElementById("result").innerHTML = "It is <strong>" + xhttp.responseText+"</strong>";
				}
				xhttp.send();
				sendRequest();	
			}
			
			function sendRequest(){
				document.getElementById("inprogress").style.visibility ="visible"
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					if (xhttp.readyState == 4) {
					    if (xhttp.status == 404){
						    requests+=0.1;
					    	setTimeout(function() { sendRequest(); }, 800);
					    	document.getElementById("inprogress").value = (requests/10);
					    } else if (xhttp.status == 200){
						    document.getElementById("result").innerHTML = "It is <strong>" + xhttp.responseText+"</strong>";
						    document.getElementById("inprogress").style.visibility ="hidden";
					    }
					  }
				};
				xhttp.open("GET", "http://localhost/cgi-bin/"+requestId+".txt", true);
				xhttp.send();
			}
		</script>
	</head>
	<body>
		<section>
			<h1>Music Genre Identifier</h1>
			<form action="#" method="get">
				<input id="urlfield" autocomplete="on" autofocus type="url" name="youtubeurl" value="youtube.com/watch?v=PNjG22Gbo6U" placeholder="youtube.com/watch?v=PNjG22Gbo6U"/>
				<input type="submit" value="Get genre" onclick="initalRequest();">
			</form>
			<progress id="inprogress" value="0"></progress>
			<h2 id="result"></h2>
		</section>
	</body>
</html>